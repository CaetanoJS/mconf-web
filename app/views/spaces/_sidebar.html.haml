// Locals:
//   space (Space): the target space

= content_for :sidebar do
  .resource-card
    = link_to space_path(space) do
      = logo_image(space, :size => "336x256", :title => space.name)

    .data
      - if space.name.size > 60
        .data-main
          = link_to space_path(space) do
            = sanitize(first_words(space.name, 60))
      - else
        .data-main
          = link_to space_path(space) do
            = sanitize(space.name)
      .data-other
        - if space.public
          .resource-visibility.public
            = icon_space_public
            = t(".public")
        - else
          .resource-visibility.private
            = icon_space_private
            = t(".private")
      .data-other
        - if user_signed_in? && space.users.include?(current_user)
          %span.user-is-member
            = icon_is_member
            = t(".is_member")

      -#  TODO
      -# - if current_site.require_space_approval? && !@space.approved?
      -#   .resource-waiting-tooltip
      -#     = icon_waiting_moderation
      -#     = t("_other.not_approved.text")
      -#     - if can?(:approve, @space)
      -#       - link = link_to(t('.manage_to_approve'), manage_spaces_path(q: @space.name))
      -#       = ("(" + link + ")").html_safe

  = render :partial => 'spaces/sidebar_join_links'

= content_for :sidebar_menu do
  %ul
    %li{ spaces_menu_select_if(:home) }
      = link_to t('.home'), space_path(@space)

    - if can?(:webconference, @space)
      %li{ spaces_menu_select_if(:webconference) }
        = link_to t('.webconference'), webconference_space_path(@space)

    - if can?(:index, Post.new(space: @space))
      %li{ spaces_menu_select_if(:posts) }
        = link_to t('.posts'), space_posts_path(@space)

    - if mod_enabled?("events") && can?(:index_event, @space)
      %li{ spaces_menu_select_if(:events) }
        = link_to t('.events'), space_events_path(@space)

    %li{ spaces_menu_select_if(:users) }
      = link_to t('.users'), space_users_path(@space)

    - if @space.repository? && can?(:index, Attachment.new(space: @space))
      %li{ spaces_menu_select_if(:repository) }
        = link_to t('.repository'), space_attachments_path(@space)

    - if user_signed_in?
      - if @space.role_for?(current_user, :name => 'Admin') || current_user.superuser?
        %li{ spaces_menu_select_if(:admin) }
          = link_to t('.admin'), edit_space_path(@space), :class => "admin danger-text"

  -# TODO
  -# = render :partial => 'spaces/sidebar_notifications'
  -# = render_sidebar_content_block("sidebar-space-admins") do
  -#   .content-block-header
  -#     %h4= t('user.administrators')
  -#     = icon_help t("tooltip.admin"), :class => 'leftwards'
  -#   .content-block-middle
  -#     - @space.admins.each do |user|
  -#       = render :partial => 'users/simple_user', :locals => { :user => user }
  -# - if user_signed_in? && can?(:leave, @space)
  -#   = render :partial => 'spaces/sidebar_leave_space'
